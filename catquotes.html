<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Cat Quote Widget</title>
  <link rel="stylesheet" href="styles.css" />
  <script src="themes.js"></script>
</head>

<body>
  <div class="widget" id="widget">
    <div class="cat" id="catEmoji"></div>
    <div class="quote" id="quote"></div>
  </div>

  <script>
    const QUOTES = [
      "Purr-gress, not purr-fection.",
      "One task at a timeâ€¦ like batting toys under the couch.",
      "Stay paw-sitive, youâ€™re claw-ing through it!",
      "Tackle your tasks, then enjoy a cozy nap.",
      "Tasks today, catnap later.",
      "Conquer the list, claim the sunny spot.",
      "Less hiss, more blissâ€”get it done.",
      "Whisker by whisker, youâ€™re making progress."
    ];

    const EMOJIS = ["ðŸ±", "ðŸˆ", "ðŸˆâ€â¬›", "ðŸ¾", "ðŸ˜¸"];

    const quoteEl = document.getElementById('quote');
    const catEl = document.getElementById('catEmoji');
    const widgetEl = document.getElementById('widget');

    let index = 0;

    // A function to set the theme of the widget.
    function applyTheme(themeClass, colors) {
      document.body.className = themeClass;
      document.documentElement.style.setProperty('--widget-bg-color', colors[0]);
      document.documentElement.style.setProperty('--text-color', colors[1]);
      document.documentElement.style.setProperty('--accent-color', colors[2]);
      document.documentElement.style.setProperty('--widget-border-color', colors[3]);
      widgetEl.style.color = colors[1];
    }

    // Function to get a random theme.
    function getRandomTheme() {
      const themesArray = Object.values(allThemes);
      const randomTheme = themesArray[Math.floor(Math.random() * themesArray.length)];
      return randomTheme;
    }

    function render(nextIndex) {
      index = (nextIndex + QUOTES.length) % QUOTES.length;
      quoteEl.textContent = QUOTES[index];
      catEl.textContent = EMOJIS[Math.floor(Math.random() * EMOJIS.length)];
    }

    function initializeWidget() {
      // Check if a theme is selected.
      if (typeof selectedTheme !== 'undefined' && selectedTheme !== null) {
        if (selectedTheme === 'random') {
          // If "random" is selected, get a random theme from allThemes.
          const theme = getRandomTheme();
          applyTheme(theme.class, theme.colors);
        } else {
          // Otherwise, get the selected theme from the allThemes object.
          const theme = Object.values(allThemes).find(t => t.class === selectedTheme);
          if (theme) {
            applyTheme(theme.class, theme.colors);
          } else {
            // Fallback to a default theme if the selected theme is not found.
            const defaultTheme = getRandomTheme();
            applyTheme(defaultTheme.class, defaultTheme.colors);
            console.log("Error: Selected theme not found. Applying random theme as fallback.");
          }
        }
      } else {
        // Fallback to a random theme if no theme is defined.
        const defaultTheme = getRandomTheme();
        applyTheme(defaultTheme.class, defaultTheme.colors);
        console.log("No theme selected. Applying random theme as fallback.");
      }
      render(0);
      setInterval(() => render(index + 1), 10000);
    }

    initializeWidget();
  </script>
</body>

</html>
