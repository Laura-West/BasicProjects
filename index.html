<!--
  This is your Theme Control Panel.
  Use this file to select a theme for all your widgets and generate the
  configuration file that all widgets will use.
-->

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Theme Control Panel</title>
    <link rel="stylesheet" href="styles.css">
    
    <style>
      body {
        margin: 0;
        padding: 20px;
        font-family: var(--font-family);
        background-color: var(--primary-bg-color);
        color: var(--primary-text-color);
        transition: background-color 0.5s ease, color 0.5s ease;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        min-height: 100vh;
        text-align: center;
      }
      .container {
        max-width: 600px;
        width: 90%;
        padding: 24px;
        border-radius: 12px;
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        background-color: var(--secondary-bg-color);
        border: 1px solid var(--accent-color);
      }
      h1 {
        font-size: 2.5rem;
        margin-bottom: 12px;
        color: var(--primary-text-color);
      }
      p {
        font-size: 1rem;
        color: var(--primary-text-color);
      }
      .theme-selector-container {
        display: flex;
        flex-direction: column;
        align-items: center;
        margin-top: 24px;
      }
      #theme-select {
        margin-bottom: 12px;
        padding: 8px 12px;
        border-radius: 6px;
        border: 1px solid var(--accent-color);
        background-color: var(--primary-bg-color);
        color: var(--primary-text-color);
      }
      .theme-preview {
        display: flex;
        gap: 0;
        border-radius: 8px;
        padding: 4px;
        background-color: var(--secondary-bg-color);
        border: 1px solid var(--accent-color);
      }
      .preview-square {
        width: 50px;
        height: 50px;
        border: none;
      }
      #save-btn, #edit-btn {
        margin-top: 20px;
        padding: 10px 20px;
        font-size: 1rem;
        font-weight: bold;
        color: var(--secondary-bg-color);
        background-color: var(--accent-color);
        border: none;
        border-radius: 8px;
        cursor: pointer;
        transition: background-color 0.3s ease;
      }
      #save-btn:hover, #edit-btn:hover {
        background-color: color-mix(in srgb, var(--accent-color) 80%, black);
      }
      .edit-panel {
        margin-top: 20px;
        display: none;
        flex-direction: column;
        align-items: center;
        width: 100%;
        max-width: 400px;
      }
      .edit-panel.active {
        display: flex;
      }
      .edit-group {
        display: flex;
        flex-direction: column;
        width: 100%;
        margin-bottom: 12px;
        align-items: center;
      }
      .edit-group label {
        margin-bottom: 8px;
      }
      .edit-group input[type="text"], .edit-group input[type="color"] {
        width: 100%;
        padding: 8px;
        border-radius: 6px;
        border: 1px solid var(--accent-color);
        background-color: var(--primary-bg-color);
        color: var(--primary-text-color);
        box-sizing: border-box;
      }
      .color-inputs {
        display: flex;
        gap: 8px;
        width: 100%;
        justify-content: space-between;
      }
      .color-inputs input[type="color"] {
        width: 50px;
        height: 50px;
        padding: 0;
        border: none;
        cursor: pointer;
      }
      .edit-actions button, .delete-btn {
        padding: 8px 16px;
        font-size: 0.9rem;
        font-weight: bold;
        border: none;
        border-radius: 8px;
        cursor: pointer;
        transition: background-color 0.3s ease;
      }
      .delete-btn {
        background-color: #e74c3c;
        color: white;
      }
      .delete-btn:hover {
        background-color: #c0392b;
      }
      .add-btn {
        background-color: #27ae60;
        color: white;
        margin-top: 10px;
      }
      .add-btn:hover {
        background-color: #229954;
      }
    </style>
</head>
<body>

  <div class="container">
    <h1>Theme Control Panel</h1>
    <p>Select a theme below. When you're happy with your choice, click "Save Theme" to update all your widgets.</p>

    <div class="theme-selector-container">
      <label for="theme-select">Select a Theme:</label>
      <select id="theme-select"></select>
      <div class="theme-preview" id="theme-preview"></div>
      <div>
        <button id="save-btn">Save Theme</button>
        <button id="edit-btn">Edit Themes</button>
      </div>
    </div>

    <div class="edit-panel" id="edit-panel">
      <h2>Edit Themes</h2>
      <div class="edit-group">
        <label for="new-theme-name">New Theme Name:</label>
        <input type="text" id="new-theme-name" placeholder="e.g., Ocean Breeze">
      </div>
      <div class="edit-group">
        <label>New Theme Colors (4):</label>
        <div class="color-inputs">
          <input type="color" id="color1" value="#ffffff">
          <input type="color" id="color2" value="#ffffff">
          <input type="color" id="color3" value="#ffffff">
          <input type="color" id="color4" value="#ffffff">
        </div>
      </div>
      <button class="add-btn" id="add-theme-btn">Add New Theme</button>
      
      <div class="edit-group">
        <h3>Delete a Theme</h3>
        <p>Select a theme from the dropdown above and click "Delete".</p>
        <button class="delete-btn" id="delete-theme-btn">Delete Selected Theme</button>
      </div>
    </div>
  </div>

  <script>
    document.addEventListener('DOMContentLoaded', () => {
      const body = document.body;
      const themeSelect = document.getElementById('theme-select');
      const themePreview = document.getElementById('theme-preview');
      const saveBtn = document.getElementById('save-btn');
      const editBtn = document.getElementById('edit-btn');
      const editPanel = document.getElementById('edit-panel');
      const newThemeNameInput = document.getElementById('new-theme-name');
      const colorInputs = [
        document.getElementById('color1'),
        document.getElementById('color2'),
        document.getElementById('color3'),
        document.getElementById('color4')
      ];
      const addThemeBtn = document.getElementById('add-theme-btn');
      const deleteThemeBtn = document.getElementById('delete-theme-btn');
      
      let allThemes = {};

      const defaultThemes = {
        "Gilded Iris": { class: "gilded-iris-theme", colors: ["#4b0082", "#fce883", "#ffc94b", "#3b0066"] },
        "Cosmic Dust": { class: "cosmic-dust-theme", colors: ["#0c1c38", "#e0e6f2", "#f0a07c", "#172a4e"] },
        "Twilight Garden": { class: "twilight-garden-theme", colors: ["#2b004a", "#f0e6f7", "#ff4500", "#43126f"] },
        "Sapphire Night": { class: "sapphire-night-theme", colors: ["#191970", "#e1efff", "#00ffff", "#2d2d86"] },
        "Midnight Bloom": { class: "midnight-bloom-theme", colors: ["#0d0f19", "#e6e6fa", "#ff69b4", "#1a1e2f"] },
        "Deep Sea Pearl": { class: "deep-sea-pearl-theme", colors: ["#1c3144", "#f0f8ff", "#c0fefe", "#2c445c"] },
        "Amethyst Mist": { class: "amethyst-mist-theme", colors: ["#6a5acd", "#f0f0ff", "#1e1e1e", "#8a7cde"] },
        "Starlight": { class: "starlight-theme", colors: ["#0c1223", "#f8f8ff", "#d1b281", "#1a243e"] },
        "Ruby Radiance": { class: "ruby-radiance-theme", colors: ["#3f1e1e", "#f5f5f5", "#e74c3c", "#5d3333"] },
        "Azure Dream": { class: "azure-dream-theme", colors: ["#87cefa", "#1e2a3a", "#34495e", "#b0e0e6"] }
      };

      // Load themes from local storage or use defaults
      try {
        const storedThemes = JSON.parse(localStorage.getItem('savedThemes'));
        allThemes = storedThemes || defaultThemes;
      } catch (e) {
        console.error("Could not parse saved themes from localStorage.", e);
        allThemes = defaultThemes;
      }

      function slugify(text) {
        return text.toString().toLowerCase()
          .replace(/\s+/g, '-')           // Replace spaces with -
          .replace(/[^\w-]+/g, '')       // Remove all non-word chars
          .replace(/--+/g, '-')         // Replace multiple - with single -
          .replace(/^-+/, '')             // Trim - from start of text
          .replace(/-+$/, '');            // Trim - from end of text
      }

      function setupThemeSelector() {
        themeSelect.innerHTML = '';
        const randomOption = document.createElement('option');
        randomOption.value = 'random';
        randomOption.textContent = 'Random';
        themeSelect.appendChild(randomOption);
        
        for (const [name, data] of Object.entries(allThemes)) {
          const option = document.createElement('option');
          option.value = data.class;
          option.textContent = name;
          themeSelect.appendChild(option);
        }
        
        const initialTheme = localStorage.getItem('selectedTheme') || Object.values(allThemes)[0].class;
        themeSelect.value = initialTheme;
        body.className = initialTheme;
        updateThemePreview(initialTheme);
      }
      
      function updateThemePreview(themeClass) {
        themePreview.innerHTML = '';
        let themeData;
        
        if (themeClass === 'random') {
          const themeKeys = Object.keys(allThemes);
          const randomKey = themeKeys[Math.floor(Math.random() * themeKeys.length)];
          themeData = allThemes[randomKey];
        } else {
          themeData = Object.values(allThemes).find(t => t.class === themeClass);
        }
      
        if (themeData) {
          themeData.colors.forEach(color => {
            const square = document.createElement('div');
            square.className = 'preview-square';
            square.style.backgroundColor = color;
            themePreview.appendChild(square);
          });
        }
      }
      
      themeSelect.addEventListener('change', (event) => {
        const selectedClass = event.target.value;
        if (selectedClass !== 'random') {
          body.className = selectedClass;
        }
        updateThemePreview(selectedClass);
      });

      editBtn.addEventListener('click', () => {
        editPanel.classList.toggle('active');
      });

      addThemeBtn.addEventListener('click', () => {
        const name = newThemeNameInput.value.trim();
        if (!name) {
          console.error("Theme name cannot be empty.");
          return;
        }
        const themeClass = slugify(name);
        const colors = colorInputs.map(input => input.value);
        
        allThemes[name] = { class: themeClass, colors: colors };
        
        localStorage.setItem('savedThemes', JSON.stringify(allThemes));
        setupThemeSelector();
        updateThemePreview(themeClass);
        newThemeNameInput.value = '';
        console.log(`Theme "${name}" added!`);
      });

      deleteThemeBtn.addEventListener('click', () => {
        const selectedName = themeSelect.options[themeSelect.selectedIndex].textContent;
        if (selectedName === 'Random') {
          console.error("Cannot delete the Random option.");
          return;
        }
        
        delete allThemes[selectedName];
        
        localStorage.setItem('savedThemes', JSON.stringify(allThemes));
        setupThemeSelector();
        updateThemePreview(Object.values(allThemes)[0].class);
        console.log(`Theme "${selectedName}" deleted.`);
      });
      
      saveBtn.addEventListener('click', () => {
        const selectedOption = themeSelect.value;
        const fileContent = `const allThemes = ${JSON.stringify(allThemes, null, 2)};\nconst selectedTheme = '${selectedOption}';`;
        
        const blob = new Blob([fileContent], { type: 'text/plain' });
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = 'themes.js';
        document.body.appendChild(a);
        a.click();
        document.body.removeChild(a);
        URL.revokeObjectURL(url);
      
        localStorage.setItem('selectedTheme', selectedOption);
      
        console.log('themes.js has been generated. Please download it and upload it to your GitHub repository.');
      });
      
      setupThemeSelector();
    });
  </script>

</body>
</html>
