<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Main Quote Widget</title>
    <link rel="stylesheet" href="styles.css" />
    <style>
        body {
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            font-family: sans-serif;
            background-color: var(--bg-color);
            color: var(--font-color);
            transition: background-color 0.5s, color 0.5s;
        }

        .widget {
            position: relative;
            width: min(720px, 92vw);
            border-radius: 12px;
            border: 2px solid var(--header-color);
            padding: 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 12px;
            background-color: var(--bg-color);
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            transition: background-color 0.5s, border-color 0.5s;
        }

        .quote-content {
            font-family: var(--font-family);
            font-size: 2em;
            font-weight: 500;
            line-height: 1.4;
            color: var(--font-color);
            transition: color 0.5s;
        }

        .quote-author {
            font-family: var(--font-family);
            font-size: 1.2em;
            font-style: italic;
            font-weight: 400;
            color: var(--accent-color);
            transition: color 0.5s;
        }
    </style>
    <script src="config.js"></script>
</head>

<body>
    <div class="widget">
        <div id="quote-content" class="quote-content"></div>
        <div id="quote-author" class="quote-author"></div>
    </div>

    <script>
        const quoteContentEl = document.getElementById('quote-content');
        const authorEl = document.getElementById('quote-author');
        let QUOTES = [];
        let index = 0;

        function render(nextIndex) {
            if (QUOTES.length === 0) return;
            index = (nextIndex + QUOTES.length) % QUOTES.length;
            const quote = QUOTES[index];
            quoteContentEl.textContent = `\"${quote.quote}\"`;
            authorEl.textContent = quote.author;
        }

        async function fetchQuotes() {
            try {
                const response = await fetch('ScriptureQuotes.json');
                if (!response.ok) {
                    throw new Error(`HTTP error! Status: ${response.status}`);
                }
                const data = await response.json();
                if (data.quotes && Array.isArray(data.quotes)) {
                    QUOTES = data.quotes;
                } else {
                    throw new Error("Invalid quotes format.");
                }
            } catch (error) {
                console.error("Failed to fetch quotes:", error);
                quoteContentEl.textContent = "Error loading quotes.";
                authorEl.textContent = "";
                return;
            }
            render(0);
            setInterval(() => render(index + 1), 300000); // 300000 ms = 5 minutes
        }

        function initializeWidget() {
            // Check if the widgetConfig object exists and apply settings
            if (typeof widgetConfig !== 'undefined') {
                if (widgetConfig.theme) {
                    document.body.className = widgetConfig.theme;
                }
                if (widgetConfig.alignment) {
                    quoteContentEl.style.textAlign = widgetConfig.alignment;
                }
            } else {
                // Fallback to a default theme if config.js is not loaded
                document.body.className = 'gilded-iris-theme';
            }
            fetchQuotes();
        }
        initializeWidget();
    </script>
</body>

</html>